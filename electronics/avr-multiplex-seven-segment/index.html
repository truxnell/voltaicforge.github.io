<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Multiplexing Seven Segment with AVR | VoltaicForge</title>
<meta name="description" content="Multiplexing example with a dual seven segment display with a ATTiny 2313a">


  <meta name="author" content="Nat Allan">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_GB">
<meta property="og:site_name" content="VoltaicForge">
<meta property="og:title" content="Multiplexing Seven Segment with AVR">
<meta property="og:url" content="https://voltaicforge.com/electronics/avr-multiplex-seven-segment/">


  <meta property="og:description" content="Multiplexing example with a dual seven segment display with a ATTiny 2313a">



  <meta property="og:image" content="https://voltaicforge.com/assets/images/multiplex_sevensegment_avr_teaser.jpg">



  <meta name="twitter:site" content="@voltaicforge">
  <meta name="twitter:title" content="Multiplexing Seven Segment with AVR">
  <meta name="twitter:description" content="Multiplexing example with a dual seven segment display with a ATTiny 2313a">
  <meta name="twitter:url" content="https://voltaicforge.com/electronics/avr-multiplex-seven-segment/">

  
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content="https://voltaicforge.com/assets/images/multiplex_sevensegment_avr_teaser.jpg">
  

  
    <meta name="twitter:creator" content="@voltaicforge">
  



  <meta property="article:published_time" content="2016-05-29T00:00:00+10:00">





  

  


<link rel="canonical" href="https://voltaicforge.com/electronics/avr-multiplex-seven-segment/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Nat Allan",
      "url": "https://voltaicforge.com/",
      "sameAs": ["https://twitter.com/voltaicforge"]
    
  }
</script>


  <meta name="google-site-verification" content="iK_FoY5mh80PyafnPtAX6YOOtXL8eQ3Z8MqGBnTqK60" />


  <meta name="msvalidate.01" content="81692DABF6D3A748A99701D5182C57AB">


  <meta name="alexaVerifyID" content="mQysQJJ0XzBFJy5Y0GfkGmRIc_8">


  <meta name="yandex-verification" content="41039ce397f24d4e">


<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="VoltaicForge Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/mstile-70x70.png" alt=""></a>
        
        <a class="site-title" href="/">
          VoltaicForge
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/year-archive/">Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li><li class="masthead__menu-item">
              <a href="/guides/">Guides</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      
  







<div class="page__hero--overlay"
  style=" background-image: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('/assets/images/multiplex_sevensegment_avr_teaser.jpg');"
>
  
    <div class="wrapper">
      <h1 id="page-title" class="page__title" itemprop="headline">
        
          Multiplexing Seven Segment with AVR

        
      </h1>
      
        <p class="page__lead">Multiplexing example with a dual seven segment display with a ATTiny 2313a
</p>
      
      
        <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read

</p>
      
      
      
    </div>
  
  
</div>





<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/profile.jpg" alt="Nat Allan" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Nat Allan</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Analogue at birth, digital by design</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Victoria, Melbourne</span>
        </li>
      

      

      
        <li>
          <a href="http://voltaicforge.com" itemprop="url">
            <i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">Website</span>
          </a>
        </li>
      

      

      

      
        <li>
          <a href="https://twitter.com/voltaicforge" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span>
          </a>
        </li>
      

      

      

      

      

      

      

      
        <li>
          <a href="https://github.com/voltaicforge" itemprop="sameAs" rel="nofollow noopener noreferrer">
            <i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span>
          </a>
        </li>
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Multiplexing Seven Segment with AVR">
    <meta itemprop="description" content="Multiplexing example with a dual seven segment display with a ATTiny 2313a">
    <meta itemprop="datePublished" content="2016-05-29T00:00:00+10:00">
    

    <div class="page__inner-wrap">
      

      <section class="page__content" itemprop="text">
        
        <h2 id="multiplexing-a-dual-seven-segment-display">Multiplexing a dual seven segment display</h2>

<p>Following on from driving a seven segment with an ATTiny2313a last <a href="/electronics/poormans-seven-segment/">post</a> I swapped out the single seven segment for a dual seven segment that I bought from AliExpress.  This one was a dual display with a similar set of 10-pin inputs like the last, single one.  The pins from A-G+DP are different to the last, but more tellingly instead of two anode pins for the single display, there is now an anode pin for each segment.  Power one pin with some of the LEDs pulling to ground and one lights up, power the other and the other one lights up.  And if you power both, you get both sides displaying the same thing.</p>

<p>I found a post at (<a href="http://codeandlife.com/2012/02/24/7-segment-multiplexing-with-uln2003-pnp-transistors/">codeandlife.com</a>) that helped me out with the timers &amp; interrupts, which again I’ve found harder to find relevant code for:</p>

<p class="text-center"><a href="/assets/images/F5261bh_pinout.png"><picture>
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-639by292-c8086c.png" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 2.0), (min-width: 40em) and (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-639by292-c8086c.png" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 1.5), (min-width: 40em) and (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-600by274-c8086c.png" media="(min-width: 40em)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-639by292-c8086c.png" media="(-webkit-min-device-pixel-ratio: 2.0), (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-639by292-c8086c.png" media="(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-600by274-c8086c.png" />
    <img src="https://voltaicforge.com/assets/images/resize/F5261bh_pinout-600by274-c8086c.png" alt="Dual sevent segment dual display pinout" title="Dual sevent segment dual display pinout" />
  </picture>
</a></p>
<p>Here we need to multiplex.  What is that?  Well, multiplexing is described as:</p>

<blockquote>
  <p>Telecommunications. of, relating to, or using equipment permitting the simultaneous transmission of two or more trains of signals or messages over a single channel.</p>
</blockquote>

<p>In this case, to drive one seven segment we have already used 7 pins + power.  If we added another stand alone display, that would become 14.  What about building a clock with 4 digits, do we go and get an MCU with 28 or more pins?</p>

<p>Nope.  What we do is setup an array of seven segments (two in this proof-of-concept case) which share a common set of lines to drive each LED.  But we split the input lines (in this case anode) to the LEDS so we can drive them independent of each other.  This enables us to set the AVR pins to sink current to enable one number, and turn the first part of the display on.  After a brief delay, we turn that segment off, change the AVR pins for the second number, and turn on the second part of the display.</p>

<p>I’ve measured this rig at between 5-15mA, depending on what is lit up (with a number 8 being the most)</p>

<p class="notice--warning"><strong>Warning:</strong> Keep in mind as well that an ATTiny2313a is rated to 20mA sourcing of current.  Exceed that and you might burn it out!</p>

<p>If we do this very fast (I measured the frequency at around 250mhz) the human eye blends together images and we see both sides lit up simultaneously.   This is extremely common and you may be surprised to find where this occurs.  If you have a DSLR, try taking very short exposures of LED displays!</p>

<h2 id="wiring-up-the-breadboard">Wiring up the breadboard</h2>

<p class="text-center"><a href="/assets/images/multiplex_sevensegment_avr.jpg"><picture>
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-1200by795-f1f59c.jpg" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 2.0), (min-width: 40em) and (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-900by596-f1f59c.jpg" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 1.5), (min-width: 40em) and (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-600by397-f1f59c.jpg" media="(min-width: 40em)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-1200by795-f1f59c.jpg" media="(-webkit-min-device-pixel-ratio: 2.0), (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-900by596-f1f59c.jpg" media="(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-600by397-f1f59c.jpg" />
    <img src="https://voltaicforge.com/assets/images/resize/multiplex_sevensegment_avr-600by397-f1f59c.jpg" alt="Multiplexing a dual seven segment display with a ATTiny2313a" title="Multiplexing a dual seven segment display with a ATTiny2313a" />
  </picture>
</a></p>

<p>So I rewired the breadboard up similar to last time, but taking into account the different pins.  Also, instead of +5 going to one of the anode pins of the seven segment I wired one anode of the seven segment to PD4 and the other to PD5 of the ATTiny2313 - this time the AVR will drive the anodes.</p>

<table>
  <thead>
    <tr>
      <th>avr-pin</th>
      <th>letter</th>
      <th>led-pin</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>PB7</td>
      <td>A</td>
      <td>pin 10</td>
    </tr>
    <tr>
      <td>PB6</td>
      <td>B</td>
      <td>pin 9</td>
    </tr>
    <tr>
      <td>PB5</td>
      <td>C</td>
      <td>pin 1</td>
    </tr>
    <tr>
      <td>PB4</td>
      <td>D</td>
      <td>pin 4</td>
    </tr>
    <tr>
      <td>PB3</td>
      <td>E</td>
      <td>pin 3</td>
    </tr>
    <tr>
      <td>PB2</td>
      <td>F</td>
      <td>pin 6</td>
    </tr>
    <tr>
      <td>PB1</td>
      <td>G</td>
      <td>pin 5</td>
    </tr>
  </tbody>
</table>

<h2 id="schematic">Schematic</h2>

<p class="notice--info"><strong>Note:</strong> I couldn’t find a common-anode dual seven segment display on octopart - this is a quad display but imagine its only a dual display.</p>

<p class="notice--warning"><strong>Warning:</strong> The pinouts on this dont match above, again because the part isn’t present.  If you follow this, check your part datasheet.</p>

<p class="text-center"><a href="/assets/images/schematic_seven_segment_multiplex.png"><picture>
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-1200by791-e0cad2.png" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 2.0), (min-width: 40em) and (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-900by593-e0cad2.png" media="(min-width: 40em) and (-webkit-min-device-pixel-ratio: 1.5), (min-width: 40em) and (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-600by395-e0cad2.png" media="(min-width: 40em)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-1200by791-e0cad2.png" media="(-webkit-min-device-pixel-ratio: 2.0), (min-resolution: 192dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-900by593-e0cad2.png" media="(-webkit-min-device-pixel-ratio: 1.5), (min-resolution: 144dpi)" />
    <source srcset="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-600by395-e0cad2.png" />
    <img src="https://voltaicforge.com/assets/images/resize/schematic_seven_segment_multiplex-600by395-e0cad2.png" alt="Schematic for muiltplexing two seven segment displays with a ATTiny2313a" title="Schematic for muiltplexing two seven segment displays with a ATTiny2313a" />
  </picture>
</a></p>

<p><a href="/assets/pdf/AVR_Multiplex_Seven_Segment.PDF">PDF Schematic Download</a></p>

<p><a href="http://circuitmaker.com/Projects/0B2CC870-16DB-4604-87C3-4571C2FBB3D5">View on CircuitMaker</a></p>

<h2 id="code">Code</h2>

<p>With the below code, the display counts from 0-99.  Brightness is fine, but can be a problem with more displays.  AVR is running interal clock with clockdiv/8 fuse set.</p>

<p>Here we use a timer to increment a counter each second.  A second timer runs the multiplexing, with ~500 interrupts per second.  Thats almost it!</p>

<p class="notice--info"><strong>Note:</strong> I have started using bit flipping defines for legible code and easy of use.  Might annoy the purists!</p>

<div class="language-cpp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/*
 * PoorMansSevenSegment.cpp
 *
 * A bodge program to run a seven segment without a BCD - 7 segment display decoder
 * 
 * Created: 15/05/2016 6:50:30 PM
 * Author : Nat
 */</span> 

<span class="cp">#define F_CPU 1000000UL //CPU speed, set clockdiv/8
#include &lt;avr/io.h&gt;
#include &lt;util/delay.h&gt;
#include &lt;avr/interrupt.h&gt;
</span>
<span class="c1">// Defines for  easy bit flipping</span>
<span class="cp">#define    bit_set(...)        bit_set_(__VA_ARGS__)
#define    bit_set_(x,y)        x |= 1&lt;&lt;y            // set a bit
#define    bit_clear(...)        bit_clear_(__VA_ARGS__)
#define    bit_clear_(x,y)        x &amp;= ~(1&lt;&lt;y)            // clear a bit
#define    bit_test(...)        bit_test_(__VA_ARGS__)
#define    bit_test_(x,y)        (!!(x &amp; (1&lt;&lt;y)))        // test a bit
</span>
<span class="cm">/*** following macros related to the PORTx - register only !    ***/</span>
<span class="cm">/***                                ***/</span>
<span class="cp">#define    bit_dir_outp(...)    bit_dir_outp_(__VA_ARGS__)
#define    bit_dir_outp_(x,y)    *(&amp;x-1) |= 1&lt;&lt;y            // access DDRx of PORTx !
#define    bit_dir_inp(...)    bit_dir_inp_(__VA_ARGS__)
#define    bit_dir_inp_(x,y)    *(&amp;x-1) &amp;= ~(1&lt;&lt;y)        // access DDRx of PORTx !
#define    bit_test_in(...)    bit_test_in_(__VA_ARGS__)
#define    bit_test_in_(x,y)    (!!(*(&amp;x-2) &amp; (1&lt;&lt;y)))        // access PINx of PORTx !
</span>
<span class="c1">// pin defines</span>
<span class="cp">#define PORT_LED PORTB
#define DDR_LED DDRB
#define PORT_PWR PORTD
#define DDR_PWR DDRD
</span>
<span class="c1">// define Seven segment output ports for Vcc to Seven Segment</span>
<span class="cp">#define LED0    PORTD, 4
#define LED1    PORTD, 5
</span>
<span class="c1">//binary representations of binary required to light seven segment 0-9</span>
<span class="kt">unsigned</span> <span class="kt">int</span> <span class="n">pins</span><span class="p">[]</span> <span class="o">=</span> <span class="p">{</span><span class="mb">0b11111100</span><span class="p">,</span> <span class="mb">0b01100000</span><span class="p">,</span> <span class="mb">0b11011010</span><span class="p">,</span><span class="mb">0b11110010</span><span class="p">,</span> <span class="mb">0b01100110</span><span class="p">,</span> <span class="mb">0b10110110</span><span class="p">,</span> <span class="mb">0b10111110</span><span class="p">,</span> <span class="mb">0b11100000</span><span class="p">,</span> <span class="mb">0b11111110</span><span class="p">,</span> <span class="mb">0b11100110</span><span class="p">};</span> 
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">i_timer_seconds</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">volatile</span> <span class="kt">int</span> <span class="n">i_active_display</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kt">void</span> <span class="nf">seven_write</span><span class="p">(</span><span class="kt">int</span> <span class="n">i_digit</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// write to entire LED port - invert due to the fact that in a common anode display LOW = on.</span>
    <span class="c1">// to use in a common cathode display, remove inversion.</span>
    <span class="n">PORT_LED</span> <span class="o">=~</span> <span class="n">pins</span><span class="p">[</span><span class="n">i_digit</span><span class="p">];</span>   
<span class="p">}</span>

<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER1_COMPA_vect</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// increment timer count</span>
    <span class="n">i_timer_seconds</span><span class="o">++</span><span class="p">;</span>            
<span class="p">}</span>

<span class="n">ISR</span><span class="p">(</span><span class="n">TIMER0_OVF_vect</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">PORT_PWR</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_active_display</span><span class="o">+</span><span class="mi">4</span><span class="p">));</span>    <span class="c1">// turn off LED</span>
        <span class="c1">//toggle active display</span>
    <span class="n">i_active_display</span> <span class="o">^=</span> <span class="mi">1</span><span class="p">;</span>
	
    <span class="k">if</span><span class="p">(</span><span class="n">i_active_display</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">seven_write</span><span class="p">(</span><span class="n">i_timer_seconds</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
		<span class="n">seven_write</span><span class="p">(</span><span class="n">i_timer_seconds</span> <span class="o">/</span> <span class="mi">10</span> <span class="o">%</span> <span class="mi">10</span><span class="p">);</span>
    <span class="p">}</span> 
	
    <span class="n">PORT_PWR</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">i_active_display</span><span class="o">+</span><span class="mi">4</span><span class="p">));</span>    <span class="c1">// turn on LED</span>
<span class="p">}</span>
    
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//disable interupts</span>
    <span class="n">cli</span><span class="p">();</span>
	
    <span class="c1">//Data Direction Register, set all bits high</span>
    <span class="n">DDR_LED</span> <span class="o">=</span> <span class="mh">0xFF</span><span class="p">;</span>                <span class="c1">// enable entire LED port as output</span>
	
    <span class="c1">// set led common anode wires to outputs (PD4/5)</span>
    <span class="n">bit_dir_outp</span><span class="p">(</span><span class="n">LED0</span><span class="p">);</span>
    <span class="n">bit_dir_outp</span><span class="p">(</span><span class="n">LED1</span><span class="p">);</span>
	
    <span class="c1">// init timer 0</span>
    <span class="n">TIMSK</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">TOIE0</span><span class="p">);</span>  <span class="c1">// timer 0 overflow interupt</span>
    <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">WGM12</span><span class="p">);</span>  <span class="c1">// config for CTC mode</span>
    <span class="n">TIMSK</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">OCIE1A</span><span class="p">);</span>  <span class="c1">// CTC interupt</span>
    <span class="n">OCR1A</span> <span class="o">|=</span> <span class="mi">15625</span><span class="p">;</span>             <span class="c1">// prescaler</span>
    <span class="n">sei</span><span class="p">();</span>
    <span class="n">TCCR0B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS01</span><span class="p">);</span> <span class="c1">//timer 0 at clk/8</span>
    <span class="n">TCCR1B</span> <span class="o">|=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS11</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="n">CS10</span><span class="p">);</span> <span class="c1">//timer 1 at clk/64</span>

    <span class="k">while</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="p">{}</span>
    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>


        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#avr" class="page__taxonomy-item" rel="tag">AVR</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#seven-segment" class="page__taxonomy-item" rel="tag">Seven-segment</a>
    
    </span>
  </p>




  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#electronics" class="page__taxonomy-item" rel="tag">Electronics</a>
    
    </span>
  </p>


        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2016-05-29T00:00:00+10:00">May 29, 2016</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?via=voltaicforge&text=Multiplexing+Seven+Segment+with+AVR%20https%3A%2F%2Fvoltaicforge.com%2Felectronics%2Favr-multiplex-seven-segment%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fvoltaicforge.com%2Felectronics%2Favr-multiplex-seven-segment%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fvoltaicforge.com%2Felectronics%2Favr-multiplex-seven-segment%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/electronics/poormans-seven-segment/" class="pagination--pager" title="Poor man’s seven segment LED display with AVR
">Previous</a>
    
    
      <a href="/electronics/raspi-muiltiroom-audio/" class="pagination--pager" title="Multiroom audio with the Raspberry PI
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a Comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  
  
    <div class="page__related">
      <h4 class="page__related-title">You May Also Enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/ordbot_r2.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/3dprinting/ordbot-project/" rel="permalink">Ordbot Project added
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">My Ordbot build added to projects
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/Code.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/homelab/setup-pfsense-for-tpg-nbn/" rel="permalink">Setup pfSense for TPG NBN
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">An adventure of frustration with TPG NBN and the missing VLAN setting
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/homebrew_fermenter.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/homebrew/homebrewing-again/" rel="permalink">Homebrewing Again
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  less than 1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">Beginning a homebrewing journey
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/encrypted_encfs_dropbox.png" alt="">
      </div>
    
    <h2 class="archive__item-title" itemprop="headline">
      
        <a href="/games/dropbox-encfs/" rel="permalink">Setting up Dropbox and encryption in Linux
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">My approach to setting up Dropbox and Encfs in Linux
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Nat Allan. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-77173080-1']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://voltaicforge.com/electronics/avr-multiplex-seven-segment/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/electronics/avr-multiplex-seven-segment"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://voltaicforge.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
